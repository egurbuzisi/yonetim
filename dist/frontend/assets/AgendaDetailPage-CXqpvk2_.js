import{a as e,u as s,j as t,b as l}from"./index-CXP7xW6B.js";import{f as a,u as n,r as i}from"./react-vendor-DBkS_7n-.js";import{O as r,Q as c,R as d,c as o,r as x,$ as m,T as u,X as h,W as b,Y as p,Z as g,g as f}from"./icons-uH062rYu.js";function j(){const{id:j}=a(),N=n(),{agendas:v,addAgendaMessage:k,updateAgenda:w,deleteAgenda:y,addNotification:C}=e(),{user:S}=s(),[z,A]=i.useState(""),[T,D]=i.useState(!1),[R,G]=i.useState(!1),[M,L]=i.useState(null),[$,F]=i.useState(null),[K,E]=i.useState(!1),[B,I]=i.useState(""),[O,P]=i.useState(""),[Y,U]=i.useState([]),[V,_]=i.useState("normal"),H=i.useRef(null),Q=i.useRef(null),W=i.useRef(null),Z=i.useRef(null),q=v.find(e=>e.id===j),J=()=>{localStorage.setItem("activeTab","2"),N("/")};i.useEffect(()=>{H.current?.scrollIntoView({behavior:"smooth"})},[q?.messages.length]);if(!q)return t.jsx("div",{className:"h-[100dvh] flex items-center justify-center",children:t.jsx("p",{className:"text-slate-500",children:"Gündem bulunamadı"})});const X=S&&["baskan","ozel_kalem","baskan_yardimcisi","mudur"].includes(S.role),ee=e=>{q&&(w(q.id,{status:e}),D(!1))},se=e=>{const s=e.target.files?.[0];if(s){const e=new FileReader;e.onload=e=>{const s=document.createElement("img");s.onload=()=>{const e=document.createElement("canvas"),t=800;let l=s.width,a=s.height;l>a?l>t&&(a*=t/l,l=t):a>t&&(l*=t/a,a=t),e.width=l,e.height=a;const n=e.getContext("2d");n?.drawImage(s,0,0,l,a);const i=e.toDataURL("image/jpeg",.7);L(i)},s.src=e.target?.result},e.readAsDataURL(s)}e.target.value=""},te=()=>{(z.trim()||M)&&S&&(k(q.id,z.trim(),S.id,S.name),A(""),L(null))},le=e=>new Date(e).toLocaleDateString("tr-TR",{day:"numeric",month:"long",year:"numeric"}),ae=e=>{const s=new Date(e),t=new Date,l=Math.floor((t.getTime()-s.getTime())/864e5);return 0===l?s.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"}):1===l?"Dün":le(e)};return t.jsxs("div",{className:"h-[100dvh] bg-white flex flex-col",children:[t.jsxs("header",{className:"flex-shrink-0 bg-blue-900 text-white px-4 py-3 flex items-center justify-between safe-area-top",children:[t.jsx("button",{onClick:J,className:"p-2 hover:bg-blue-800 rounded-lg",children:t.jsx(r,{className:"w-6 h-6"})}),t.jsx("h1",{className:"font-semibold text-lg flex-1 mx-4 truncate",children:q.title}),X&&t.jsxs("div",{className:"relative",children:[t.jsx("button",{onClick:()=>D(!T),className:"p-2 hover:bg-blue-800 rounded-lg",children:t.jsx(c,{className:"w-6 h-6"})}),T&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>D(!1)}),t.jsxs("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl z-20 py-2 text-slate-700",children:[t.jsxs("button",{onClick:()=>{q&&(I(q.title),P(q.description||""),U(q.visibleTo||[]),E(!0),D(!1))},className:"w-full px-4 py-2.5 text-left hover:bg-slate-50 flex items-center gap-3",children:[t.jsx(d,{className:"w-4 h-4"})," Düzenle"]}),t.jsxs("button",{onClick:()=>{_(q.priority),G(!0),D(!1)},className:"w-full px-4 py-2.5 text-left hover:bg-slate-50 flex items-center gap-3",children:[t.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"})," Öncelik Değiştir"]}),t.jsxs("button",{className:"w-full px-4 py-2.5 text-left hover:bg-slate-50 flex items-center gap-3",children:[t.jsx(o,{className:"w-4 h-4"})," Programa Ekle"]}),t.jsx("div",{className:"border-t my-1"}),"aktif"!==q.status&&t.jsxs("button",{onClick:()=>ee("aktif"),className:"w-full px-4 py-2.5 text-left hover:bg-slate-50 flex items-center gap-3 text-blue-600",children:[t.jsx(x,{className:"w-4 h-4"})," Aktif Yap"]}),"sonuclandi"!==q.status&&t.jsxs("button",{onClick:()=>ee("sonuclandi"),className:"w-full px-4 py-2.5 text-left hover:bg-slate-50 flex items-center gap-3 text-green-600",children:[t.jsx(x,{className:"w-4 h-4"})," Sonuçlandı"]}),"arsivlendi"!==q.status&&t.jsxs("button",{onClick:()=>ee("arsivlendi"),className:"w-full px-4 py-2.5 text-left hover:bg-slate-50 flex items-center gap-3",children:[t.jsx(m,{className:"w-4 h-4"})," Arşivle"]}),t.jsx("div",{className:"border-t my-1"}),t.jsxs("button",{onClick:()=>{q&&(window.confirm("Bu gündem konusunu silmek istediğinize emin misiniz?")&&(y(q.id),J()),D(!1))},className:"w-full px-4 py-2.5 text-left hover:bg-red-50 flex items-center gap-3 text-red-600",children:[t.jsx(u,{className:"w-4 h-4"})," Sil"]})]})]})]})]}),t.jsx("div",{className:"flex-shrink-0 p-4 border-b bg-slate-50",children:t.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(e=>{switch(e){case"acil":return"text-red-600 bg-red-100";case"normal":return"text-amber-600 bg-amber-100";case"dusuk":return"text-green-600 bg-green-100";default:return"text-slate-600 bg-slate-100"}})(q.priority)}`,children:(e=>{switch(e){case"acil":return"ACİL";case"normal":return"NORMAL";case"dusuk":return"DÜŞÜK";default:return e}})(q.priority)}),t.jsx("span",{className:"text-sm text-slate-500",children:(e=>{switch(e){case"aktif":return"Aktif";case"gorusuluyor":return"Görüşülüyor";case"sonuclandi":return"Sonuçlandı";case"arsivlendi":return"Arşivlendi";default:return e}})(q.status)})]}),t.jsx("div",{className:"space-y-2 text-sm",children:t.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[t.jsx(o,{className:"w-4 h-4"}),t.jsxs("span",{children:["Oluşturulma: ",le(q.createdAt)]})]})}),q.description&&t.jsx("div",{className:"mt-3 pt-3 border-t",children:t.jsx("p",{className:"text-sm text-slate-600",children:q.description})})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[t.jsx("h3",{className:"font-semibold text-slate-700 mb-3",children:"Görüşmeler"}),t.jsxs("div",{className:"space-y-3",children:[0===q.messages.length?t.jsx("p",{className:"text-slate-500 text-center py-8",children:"Henüz görüşme yok"}):q.messages.map(e=>t.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"font-medium text-slate-700",children:e.userName}),t.jsx("span",{className:"text-xs text-slate-400",children:ae(e.createdAt)})]}),t.jsx("p",{className:"text-slate-600 text-sm",children:e.message})]},e.id)),t.jsx("div",{ref:H})]})]}),M&&t.jsx("div",{className:"flex-shrink-0 px-4 py-2 bg-slate-50 border-t",children:t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:M,alt:"Seçilen",className:"h-20 rounded-lg object-cover"}),t.jsx("button",{onClick:()=>L(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center",children:t.jsx(h,{className:"w-4 h-4"})})]})}),t.jsx("div",{className:"flex-shrink-0 p-4 border-t bg-white pb-safe",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{ref:W,type:"file",accept:"image/*",onChange:se,className:"hidden"}),t.jsx("input",{ref:Z,type:"file",accept:"image/*",capture:"environment",onChange:se,className:"hidden"}),t.jsx("button",{onClick:()=>Z.current?.click(),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg",title:"Fotoğraf Çek",children:t.jsx(b,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>W.current?.click(),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg",title:"Galeriden Seç",children:t.jsx(p,{className:"w-5 h-5"})}),t.jsx("input",{ref:Q,type:"text",value:z,onChange:e=>A(e.target.value),onFocus:()=>{setTimeout(()=>{Q.current?.scrollIntoView({behavior:"smooth",block:"center"})},300)},onKeyPress:e=>"Enter"===e.key&&te(),placeholder:"Görüş yaz...",className:"flex-1 px-4 py-3 bg-slate-100 rounded-full outline-none focus:ring-2 focus:ring-blue-500 text-base"}),t.jsx("button",{onClick:te,disabled:!z.trim()&&!M,className:"p-3 bg-blue-900 text-white rounded-full disabled:opacity-50",children:t.jsx(g,{className:"w-5 h-5"})})]})}),$&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center",onClick:()=>F(null),children:[t.jsx("button",{className:"absolute top-4 right-4 p-2 text-white",onClick:()=>F(null),children:t.jsx(h,{className:"w-8 h-8"})}),t.jsx("img",{src:$,alt:"Büyük görüntü",className:"max-w-full max-h-full object-contain p-4"})]})}),R&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>G(!1)}),t.jsxs("div",{className:"fixed inset-x-4 top-1/2 -translate-y-1/2 bg-white rounded-2xl z-50",children:[t.jsx("div",{className:"p-4 border-b",children:t.jsx("h3",{className:"font-semibold text-lg",children:"Öncelik Seç"})}),t.jsx("div",{className:"p-4 space-y-2",children:[{id:"acil",label:"ACİL",color:"bg-red-500"},{id:"normal",label:"NORMAL",color:"bg-amber-500"},{id:"dusuk",label:"DÜŞÜK",color:"bg-green-500"}].map(e=>t.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-slate-50 rounded-lg cursor-pointer",children:[t.jsx("input",{type:"radio",name:"priority",checked:V===e.id,onChange:()=>_(e.id),className:"w-5 h-5"}),t.jsx("div",{className:`w-4 h-4 rounded-full ${e.color}`}),t.jsx("span",{children:e.label})]},e.id))}),t.jsxs("div",{className:"p-4 border-t flex gap-2",children:[t.jsx("button",{onClick:()=>G(!1),className:"flex-1 py-3 border rounded-xl hover:bg-slate-50 font-medium",children:"İptal"}),t.jsx("button",{onClick:()=>{q&&(w(q.id,{priority:V}),G(!1))},className:"flex-1 py-3 bg-blue-900 text-white rounded-xl font-medium",children:"Kaydet"})]})]})]}),K&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>E(!1)}),t.jsxs("div",{className:"fixed inset-x-4 top-1/2 -translate-y-1/2 bg-white rounded-2xl z-50 max-h-[85vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("h3",{className:"font-semibold text-lg",children:"Gündem Düzenle"}),t.jsx("button",{onClick:()=>E(!1),className:"p-1 hover:bg-slate-100 rounded-lg",children:t.jsx(h,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Başlık *"}),t.jsx("input",{type:"text",value:B,onChange:e=>I(e.target.value),placeholder:"Gündem başlığı...",className:"w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Açıklama"}),t.jsx("textarea",{value:O,onChange:e=>P(e.target.value),placeholder:"Detaylı açıklama...",rows:3,className:"w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[t.jsx(f,{className:"w-4 h-4 inline mr-1"}),"Kimler Görebilsin? (",Y.length," kişi seçili)"]}),t.jsxs("div",{className:"border border-slate-300 rounded-xl p-3 max-h-40 overflow-y-auto bg-slate-50",children:[["Başkan","Özel Kalem Müdürü","Bşk. Yrd."].map(e=>{const s=l.filter(s=>s.role===e);return 0===s.length?null:t.jsxs("div",{className:"mb-2",children:[t.jsx("p",{className:"text-xs font-semibold text-slate-500 mb-1",children:e}),s.map(e=>t.jsxs("label",{className:"flex items-center gap-2 py-1 px-2 hover:bg-white rounded cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:Y.includes(e.id),onChange:s=>{s.target.checked?U([...Y,e.id]):U(Y.filter(s=>s!==e.id))},className:"w-4 h-4 rounded text-blue-600"}),t.jsx("span",{className:"text-sm text-slate-700",children:e.name})]},e.id))]},e)}),t.jsxs("div",{className:"mb-1",children:[t.jsx("p",{className:"text-xs font-semibold text-slate-500 mb-1",children:"Müdürler"}),l.filter(e=>e.role.includes("Md.")).map(e=>t.jsxs("label",{className:"flex items-center gap-2 py-1 px-2 hover:bg-white rounded cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:Y.includes(e.id),onChange:s=>{s.target.checked?U([...Y,e.id]):U(Y.filter(s=>s!==e.id))},className:"w-4 h-4 rounded text-blue-600"}),t.jsx("span",{className:"text-sm text-slate-700",children:e.name}),t.jsxs("span",{className:"text-[10px] text-slate-400",children:["(",e.role,")"]})]},e.id))]})]}),t.jsxs("div",{className:"flex gap-2 mt-2",children:[t.jsx("button",{type:"button",onClick:()=>U(l.map(e=>e.id)),className:"text-xs px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200",children:"Tümünü Seç"}),t.jsx("button",{type:"button",onClick:()=>U([]),className:"text-xs px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200",children:"Temizle"}),t.jsx("button",{type:"button",onClick:()=>{const e=l.filter(e=>e.role.includes("Md.")).map(e=>e.id);U([...new Set([...Y,...e])])},className:"text-xs px-3 py-1.5 bg-green-100 text-green-700 rounded-lg hover:bg-green-200",children:"Tüm Müdürler"})]})]})]}),t.jsxs("div",{className:"p-4 border-t flex gap-2",children:[t.jsx("button",{onClick:()=>E(!1),className:"flex-1 py-3 border rounded-xl hover:bg-slate-50 font-medium",children:"İptal"}),t.jsx("button",{onClick:()=>{if(!q||!B.trim()||!S)return;const e=Y.filter(e=>!q.visibleTo.includes(e));w(q.id,{title:B.trim(),description:O.trim(),visibleTo:Y}),e.forEach(e=>{const s=l.find(s=>s.id===e);s&&C({type:"gundem",title:"Gündem Paylaşımı",message:`${S.name}; ${s.role} (${s.name}) ${q.title} gündemi için görevlendirdi`,link:`/gundem/${q.id}`})}),E(!1)},disabled:!B.trim(),className:"flex-1 py-3 bg-blue-900 text-white rounded-xl font-medium disabled:opacity-50",children:"Kaydet"})]})]})]})]})}export{j as default};
